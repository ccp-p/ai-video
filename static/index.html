<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘AIæ€»ç»“å·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <!-- å¼•å…¥ Marked.js ç”¨äºé«˜è´¨é‡ Markdown è§£æ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        #app {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 16px;
        }

        .panel-body {
            padding: 20px;
        }

        /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
        .control-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .control-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .control-section h3 {
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"],
        input[type="file"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
            font-family: monospace;
        }

        .file-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 8px;
            background: #f8f9fa;
        }

        .file-item {
            padding: 8px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            margin-bottom: 4px;
            background: white;
            border: 1px solid #e9ecef;
        }

        .file-item:hover {
            background: #e3f2fd;
            border-color: #667eea;
        }

        .file-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .file-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-type {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            background: #e9ecef;
            color: #666;
            margin-left: 8px;
        }

        .file-item.selected .file-type {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #e9ecef;
        }

        /* å³ä¾§å†…å®¹å±•ç¤ºåŒº */
        .content-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .content-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            position: relative;
        }

        .content-tab:hover {
            background: #e9ecef;
        }

        .content-tab.active {
            color: #667eea;
            background: white;
        }

        .content-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .content-body {
            padding: 25px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }

        .result-section {
            margin-bottom: 20px;
        }

        .result-section h3 {
            color: #333;
            font-size: 16px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 12px;
            background: #e3f2fd;
            color: #667eea;
            font-weight: 600;
        }

        /* Markdown æ ·å¼ä¼˜åŒ– */
        .markdown-content {
            background: #ffffff;
            padding: 30px;
            border-radius: 8px;
            line-height: 1.8;
            font-size: 15px;
            border: 1px solid #e9ecef;
            color: #2c3e50;
        }

        .markdown-content h1 {
            font-size: 26px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            color: #2c3e50;
        }

        .markdown-content h2 {
            font-size: 20px;
            margin: 25px 0 15px;
            color: #34495e;
            font-weight: 600;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        .markdown-content h3 {
            font-size: 17px;
            margin: 20px 0 10px;
            color: #555;
            font-weight: 600;
        }

        .markdown-content p {
            margin-bottom: 16px;
            text-align: justify;
        }

        .markdown-content ul, .markdown-content ol {
            margin-left: 20px;
            margin-bottom: 16px;
            padding-left: 10px;
        }

        .markdown-content li {
            margin-bottom: 8px;
        }

        .markdown-content blockquote {
            margin: 20px 0;
            padding: 15px 20px;
            background: #f8f9fa;
            border-left: 4px solid #cbd5e0;
            color: #555;
            font-style: italic;
            border-radius: 0 4px 4px 0;
        }

        /* å›¾ç‰‡æ ·å¼ä¼˜åŒ– */
        .markdown-content img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 15px 0;
            display: block;
        }

        .markdown-content code {
            background: #f1f2f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        .markdown-content pre {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .markdown-content pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .markdown-content th, .markdown-content td {
            border: 1px solid #dfe2e5;
            padding: 8px 12px;
        }

        .markdown-content th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        /* çŠ¶æ€æç¤º */
        .status-message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-message.loading {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            margin: 15px 0;
            background: #e9ecef;
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            border-radius: 8px;
        }

        .progress-text {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 6px;
            font-weight: 500;
        }

        /* é…ç½®çŠ¶æ€ */
        .config-status {
            background: #fff3cd;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 8px;
            border: 1px solid #ffeaa7;
        }

        .config-status.ok {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        .content-body::-webkit-scrollbar,
        .file-list::-webkit-scrollbar {
            width: 6px;
        }

        .content-body::-webkit-scrollbar-track,
        .file-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .content-body::-webkit-scrollbar-thumb,
        .file-list::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }

        .content-body::-webkit-scrollbar-thumb:hover,
        .file-list::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        /* æŠ˜å é¢æ¿ */
        .collapsible {
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            overflow: hidden;
        }

        .collapsible-header {
            background: #f8f9fa;
            padding: 10px 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .collapsible-header:hover {
            background: #e9ecef;
        }

        .collapsible-content {
            padding: 12px;
            background: white;
            border-top: 1px solid #e9ecef;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }

        .collapsible-content::-webkit-scrollbar {
            width: 4px;
        }

        .collapsible-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ¬ éŸ³é¢‘/è§†é¢‘AIæ€»ç»“å·¥å…·</h1>
            <p>Bç«™è¯­éŸ³è¯†åˆ« + è‡ªåŠ¨æ‘˜è¦ + Markdownè¾“å‡º</p>
        </div>

        <!-- ä¸»å¸ƒå±€ -->
        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šæ§åˆ¶é¢æ¿ -->
            <div class="panel">
                <div class="panel-header">
                    ğŸ”§ æ§åˆ¶é¢æ¿
                </div>
                <div class="panel-body">

                    <!-- æ­¥éª¤1ï¼šæ–‡ä»¶é€‰æ‹© -->
                    <div class="control-section">
                        <h3>ğŸ“ 1. é€‰æ‹©æ–‡ä»¶</h3>
                        <div class="form-group">
                            <label>ä¸‹è½½ç›®å½•æ–‡ä»¶ï¼š</label>
                            <div class="file-list" v-if="fileList.length > 0">
                                <div
                                    class="file-item"
                                    :class="{ selected: selectedFile === file.path }"
                                    v-for="file in fileList"
                                    :key="file.path"
                                    @click="selectFile(file.path)"
                                >
                                    <span class="file-name">{{ file.name }}</span>
                                    <span class="file-type">{{ file.type }}</span>
                                </div>
                            </div>
                            <div v-else class="status-message info">
                                <span>âš ï¸</span>
                                <span>{{ fileListMessage }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- æ­¥éª¤2ï¼šè§†é¢‘å¤„ç† -->
                    <div class="control-section">
                        <h3>ğŸ¬ 2. è§†é¢‘å¤„ç†</h3>
                        <div class="form-group">
                            <label>è§†é¢‘è·¯å¾„ï¼ˆæˆ–ä½¿ç”¨ä¸Šæ–¹é€‰æ‹©ï¼‰ï¼š</label>
                            <input type="text" v-model="videoPath" placeholder="D:/download/video.mp4">
                        </div>
                        <button class="btn btn-primary" @click="processVideo" :disabled="processing || !videoPath">
                            <span v-if="processing">
                                <span class="spinner"></span> å¤„ç†ä¸­...
                            </span>
                            <span v-else>å¼€å§‹å¤„ç†è§†é¢‘</span>
                        </button>

                        <div class="progress-container" :class="{ active: processing }">
                            <div class="progress-bar" :style="{ width: progress + '%' }"></div>
                        </div>
                        <div v-if="processing" class="progress-text">{{ progress }}% - {{ progressMessage }}</div>
                    </div>

                    <!-- æ­¥éª¤3ï¼šAIæ€»ç»“ -->
                    <div class="control-section">
                        <h3>ğŸ¤– 3. AIæ€»ç»“</h3>
                        <div class="form-group">
                            <label>æ–‡æœ¬å†…å®¹ï¼š</label>
                            <textarea v-model="aiText" placeholder="ç²˜è´´æ–‡æœ¬æˆ–ä»è§†é¢‘å¤„ç†ç»“æœä¸­è·å–..."></textarea>
                        </div>
                        <!-- ç§»é™¤äº†æ‰‹åŠ¨æˆªå›¾è·¯å¾„è¾“å…¥ï¼Œå› ä¸ºç°åœ¨ç”±AIè‡ªåŠ¨å¤„ç† -->
                        <div class="status-message info" style="font-size: 12px; padding: 8px;">
                            ğŸ’¡ AIå°†è‡ªåŠ¨åˆ†æå†…å®¹å¹¶æˆªå–å…³é”®ç”»é¢
                        </div>
                        <button class="btn btn-primary" @click="aiSummarize" :disabled="summarizing || !aiText">
                            <span v-if="summarizing">
                                <span class="spinner"></span> æ™ºèƒ½åˆ†æä¸­...
                            </span>
                            <span v-else>ç”Ÿæˆå›¾æ–‡æ€»ç»“</span>
                        </button>
                    </div>

                    <!-- é…ç½® -->
                    <div class="control-section">
                        <h3>âš™ï¸ 4. AIé…ç½®ï¼ˆå¯é€‰ï¼‰</h3>
                        <div class="form-group">
                            <label>API Keyï¼š</label>
                            <input type="text" v-model="config.api_key" placeholder="ç•™ç©ºä½¿ç”¨æœ¬åœ°ç®—æ³•">
                        </div>
                        <div class="form-group">
                            <label>API URLï¼š</label>
                            <input type="text" v-model="config.api_url" placeholder="ä¾‹å¦‚ï¼šhttps://api.openai.com/v1/chat/completions">
                        </div>
                        <div class="form-group">
                            <label>æ¨¡å‹ï¼š</label>
                            <input type="text" v-model="config.model" placeholder="gpt-4, gpt-3.5-turbo">
                        </div>
                        <div class="form-group">
                            <label>è‡ªå®šä¹‰Promptï¼š</label>
                            <textarea v-model="config.custom_prompt" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤æ¨¡æ¿"></textarea>
                        </div>
                        <button class="btn btn-secondary" @click="saveConfig" :disabled="configSaving">
                            {{ configSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜é…ç½®' }}
                        </button>
                        <div class="config-status" v-if="configStatus" :class="{ ok: configStatusOk }">
                            {{ configStatus }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šç»“æœå±•ç¤º -->
            <div class="panel">
                <div class="panel-header">
                    ğŸ“Š ç»“æœå±•ç¤º
                </div>

                <!-- æ ‡ç­¾é¡µ -->
                <div class="content-tabs">
                    <button
                        class="content-tab"
                        :class="{ active: activeTab === 'summary' }"
                        @click="activeTab = 'summary'"
                    >
                        AIæ€»ç»“
                    </button>
                    <button
                        class="content-tab"
                        :class="{ active: activeTab === 'details' }"
                        @click="activeTab = 'details'"
                    >
                        åŸå§‹æ•°æ®
                    </button>
                    <button
                        class="content-tab"
                        :class="{ active: activeTab === 'screenshots' }"
                        @click="activeTab = 'screenshots'"
                    >
                        æˆªå›¾ç®¡ç†
                    </button>
                </div>

                <div class="content-body">
                    <!-- é€šçŸ¥ -->
                    <div v-if="message.text" class="status-message" :class="message.type">
                        <span v-if="message.type === 'loading'">â³</span>
                        <span v-else-if="message.type === 'success'">âœ…</span>
                        <span v-else-if="message.type === 'error'">âŒ</span>
                        <span v-else>â„¹ï¸</span>
                        {{ message.text }}
                    </div>

                    <!-- æ€»ç»“æ ‡ç­¾é¡µ -->
                    <div v-show="activeTab === 'summary'">
                        <div v-if="aiResult && aiResult.success">
                            <!-- ç§»é™¤äº†æ ¸å¿ƒè¦ç‚¹æ¨¡å—ï¼Œç›´æ¥å±•ç¤ºå®Œæ•´æ€»ç»“ -->
                            <div class="result-section">
                                <h3>ğŸ“ æ™ºèƒ½å›¾æ–‡æ€»ç»“</h3>
                                <div class="markdown-content" v-html="renderMarkdown(aiResult.markdown)"></div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <div class="empty-state-icon">ğŸ¤–</div>
                            <div class="empty-state-text">æš‚æ— AIæ€»ç»“ç»“æœï¼Œè¯·åœ¨å·¦ä¾§æ“ä½œ</div>
                        </div>
                    </div>

                    <!-- è¯¦æƒ…æ ‡ç­¾é¡µ -->
                    <div v-show="activeTab === 'details'">
                        <div v-if="processResult && processResult.success">
                            <div class="result-section">
                                <h3>ğŸ“Š è§†é¢‘ä¿¡æ¯</h3>
                                <div class="markdown-content" style="background: white;">
                                    <p><strong>è§†é¢‘è·¯å¾„ï¼š</strong><br><code>{{ processResult.audio_path }}</code></p>
                                    <p><strong>SRTå­—å¹•ï¼š</strong><br><code>{{ processResult.srt_path }}</code></p>
                                    <p><strong>è¾“å‡ºç›®å½•ï¼š</strong><br><code>{{ processResult.output_dir }}</code></p>
                                    <p><strong>è§†é¢‘æ—¶é•¿ï¼š</strong>{{ formatDuration(processResult.duration) }}</p>
                                    <p><strong>è¯†åˆ«æ®µæ•°ï¼š</strong>{{ processResult.segment_count }} æ®µ</p>
                                </div>
                            </div>

                            <div class="result-section">
                                <div class="collapsible" v-for="(seg, index) in processResult.segments.slice(0, 10)" :key="index">
                                    <div class="collapsible-header" @click="toggleSegment(index)">
                                        <span>#{{ index + 1 }} [{{ seg.start_time.toFixed(2) }}-{{ seg.end_time.toFixed(2) }}s]</span>
                                        <span>{{ expandedSegments.includes(index) ? 'â–¼' : 'â–¶' }}</span>
                                    </div>
                                    <div class="collapsible-content" v-if="expandedSegments.includes(index)">
                                        {{ seg.text }}
                                    </div>
                                </div>
                                <div v-if="processResult.segments.length > 10" style="text-align: center; color: #666; font-size: 12px; margin-top: 8px;">
                                    ... è¿˜æœ‰ {{ processResult.segments.length - 10 }} æ®µ
                                </div>
                            </div>

                            <div class="result-section">
                                <h3>ğŸ“„ SRTé¢„è§ˆ</h3>
                                <div class="collapsible">
                                    <div class="collapsible-header" @click="showSRT = !showSRT">
                                        <span>ç‚¹å‡»å±•å¼€/æŠ˜å SRTå†…å®¹</span>
                                        <span>{{ showSRT ? 'â–¼' : 'â–¶' }}</span>
                                    </div>
                                    <div class="collapsible-content" v-if="showSRT" style="white-space: pre; line-height: 1.6;">
                                        {{ processResult.srt_content }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <div class="empty-state-icon">ğŸ“Š</div>
                            <div class="empty-state-text">æš‚æ— å¤„ç†ç»“æœï¼Œè¯·å…ˆå¤„ç†è§†é¢‘</div>
                        </div>
                    </div>

                    <!-- æˆªå›¾æ ‡ç­¾é¡µ -->
                    <div v-show="activeTab === 'screenshots'">
                        <div v-if="processResult && processResult.screenshots && processResult.screenshots.length > 0">
                            <div class="result-section">
                                <h3>ğŸ“¸ æå–çš„æˆªå›¾</h3>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                                    <div v-for="shot in processResult.screenshots" :key="shot"
                                         style="padding: 8px 0; border-bottom: 1px solid #e9ecef; font-family: monospace; font-size: 12px;">
                                        {{ shot }}
                                    </div>
                                </div>
                            </div>

                            <div class="result-section">
                                <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
                                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeaa7; font-size: 13px; line-height: 1.6;">
                                    <p style="margin-bottom: 8px;"><strong>ğŸ“Œ æˆªå›¾è¯´æ˜ï¼š</strong></p>
                                    <ul style="margin-left: 20px;">
                                        <li>æˆªå›¾å·²ä¿å­˜åœ¨è§†é¢‘è¾“å‡ºç›®å½•</li>
                                        <li>å¯ä»¥åœ¨AIæ€»ç»“æ—¶å¼•ç”¨æˆªå›¾è·¯å¾„</li>
                                        <li>æˆªå›¾æ–‡ä»¶åä¼šæ˜¾ç¤ºåœ¨æ€»ç»“çš„Markdownä¸­</li>
                                        <li>æ”¯æŒåœ¨å·¦ä¾§è¾“å…¥æ¡†å¡«å…¥æˆªå›¾è·¯å¾„è¿›è¡ŒAIæ€»ç»“</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <div class="empty-state-icon">ğŸ“¸</div>
                            <div class="empty-state-text">æš‚æ— æˆªå›¾ï¼Œè¯·å…ˆå¤„ç†è§†é¢‘</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // æ–‡ä»¶åˆ—è¡¨
                    fileList: [],
                    fileListMessage: 'æ­£åœ¨åŠ è½½...',
                    selectedFile: '',

                    // è¾“å…¥æ•°æ®
                    videoPath: '',
                    aiText: '',
                    aiSegments: [], // æ–°å¢ï¼šä¿å­˜åˆ†æ®µä¿¡æ¯ä¼ ç»™AI

                    // å¤„ç†çŠ¶æ€
                    processing: false,
                    summarizing: false,
                    configSaving: false,
                    progress: 0,
                    progressMessage: '',

                    // é…ç½®
                    config: {
                        api_key: '',
                        api_url: '',
                        model: '',
                        custom_prompt: ''
                    },
                    configStatus: '',
                    configStatusOk: false,

                    // ç»“æœ
                    processResult: null,
                    aiResult: null,

                    // UIçŠ¶æ€
                    activeTab: 'summary',
                    message: {
                        text: '',
                        type: 'info'
                    },

                    // å±•å¼€çŠ¶æ€
                    expandedSegments: [],
                    showSRT: false
                };
            },
            mounted() {
                this.loadFiles();
                this.loadConfig();
            },
            methods: {
                // åŠ è½½æ–‡ä»¶åˆ—è¡¨
                async loadFiles() {
                    try {
                        this.fileListMessage = 'æ­£åœ¨åŠ è½½ç›®å½•...';
                        const response = await fetch('/api/list-files');
                        const data = await response.json();

                        if (data.success) {
                            this.fileList = data.files;
                            this.fileListMessage = this.fileList.length > 0 ? 'ç‚¹å‡»æ–‡ä»¶é€‰æ‹©' : 'ç›®å½•ä¸ºç©º';
                        } else {
                            this.fileListMessage = data.message || 'åŠ è½½å¤±è´¥';
                        }
                    } catch (error) {
                        this.fileListMessage = 'æ— æ³•è¿æ¥æœåŠ¡';
                        console.error('åŠ è½½æ–‡ä»¶å¤±è´¥:', error);
                    }
                },

                // é€‰æ‹©æ–‡ä»¶
                selectFile(path) {
                    this.selectedFile = path;
                    this.videoPath = path;
                    this.showMessage('å·²é€‰æ‹©æ–‡ä»¶ï¼š' + path, 'info');
                },

                // å¤„ç†è§†é¢‘
                async processVideo() {
                    if (!this.videoPath) {
                        this.showMessage('è¯·å…ˆé€‰æ‹©æˆ–è¾“å…¥è§†é¢‘è·¯å¾„', 'error');
                        return;
                    }

                    this.processing = true;
                    this.progress = 0;
                    this.progressMessage = 'å¼€å§‹å¤„ç†...';
                    this.expandedSegments = [];
                    this.showSRT = false;

                    // æ¨¡æ‹Ÿè¿›åº¦æ¡
                    const progressInterval = setInterval(() => {
                        if (this.progress < 85) {
                            this.progress += Math.random() * 15;
                            if (this.progress > 85) this.progress = 85;
                        }
                    }, 500);

                    try {
                        const response = await fetch('/api/process-video', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ video_path: this.videoPath })
                        });

                        clearInterval(progressInterval);
                        this.progress = 100;
                        this.progressMessage = 'å¤„ç†å®Œæˆ';

                        const data = await response.json();

                        if (data.success) {
                            this.processResult = data;
                            this.aiText = this.generateTextFromSegments(data.segments);
                            this.aiSegments = data.segments; // ä¿å­˜åˆ†æ®µä¿¡æ¯

                            this.activeTab = 'details';
                            this.showMessage('è§†é¢‘å¤„ç†å®Œæˆï¼', 'success');
                        } else {
                            this.showMessage(data.message || 'å¤„ç†å¤±è´¥', 'error');
                        }
                    } catch (error) {
                        clearInterval(progressInterval);
                        this.progress = 0;
                        this.progressMessage = '';
                        this.showMessage('è¯·æ±‚å¤±è´¥ï¼š' + error.message, 'error');
                    } finally {
                        setTimeout(() => {
                            this.processing = false;
                            this.progress = 0;
                            this.progressMessage = '';
                        }, 1000);
                    }
                },

                // AIæ€»ç»“
                async aiSummarize() {
                    if (!this.aiText) {
                        this.showMessage('è¯·å…ˆè¾“å…¥è¦æ€»ç»“çš„æ–‡æœ¬', 'error');
                        return;
                    }

                    this.summarizing = true;
                    this.showMessage('æ­£åœ¨ç”Ÿæˆæ€»ç»“...', 'loading');

                    try {
                        const response = await fetch('/api/ai-summarize', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                text: this.aiText,
                                prompt: this.config.custom_prompt,
                                segments: this.aiSegments, // ä¼ å…¥åˆ†æ®µä¿¡æ¯åŒ…å«æ—¶é—´æˆ³
                                video_path: this.videoPath // ä¼ å…¥è§†é¢‘è·¯å¾„ç”¨äºæˆªå›¾
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.aiResult = data;
                            this.activeTab = 'summary';
                            this.showMessage('AIæ€»ç»“å®Œæˆï¼', 'success');
                        } else {
                            this.showMessage(data.message || 'æ€»ç»“å¤±è´¥', 'error');
                        }
                    } catch (error) {
                        this.showMessage('è¯·æ±‚å¤±è´¥ï¼š' + error.message, 'error');
                    } finally {
                        this.summarizing = false;
                    }
                },

                // åŠ è½½é…ç½®
                async loadConfig() {
                    if(localStorage.getItem('ai_config')) {
                        this.loadFromLocal();
                    } else {
                        await this.loadFromServer();
                    }
                },
                loadFromLocal() {
                    const savedConfig = localStorage.getItem('ai_config');
                    if (savedConfig) {
                        this.config = JSON.parse(savedConfig);
                        this.updateConfigStatus();
                    } 

                },
                async loadFromServer() {
                      try {
                        const response = await fetch('/api/config');
                        const data = await response.json();

                        if (data.success && data.config) {
                            this.config = data.config;
                            this.updateConfigStatus();
                        }
                    } catch (error) {
                        console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                    }
                },

                // ä¿å­˜é…ç½®
                async saveConfig() {
                    this.configSaving = true;
                    localStorage.setItem('ai_config', JSON.stringify(this.config));

                    try {
                        const response = await fetch('/api/config', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.config)
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.showMessage('é…ç½®ä¿å­˜æˆåŠŸ', 'success');
                            this.updateConfigStatus();
                        } else {
                            this.showMessage(data.message || 'ä¿å­˜å¤±è´¥', 'error');
                        }
                    } catch (error) {
                        this.showMessage('ä¿å­˜å¤±è´¥ï¼š' + error.message, 'error');
                    } finally {
                        this.configSaving = false;
                    }
                },

                // æ›´æ–°é…ç½®çŠ¶æ€æ˜¾ç¤º
                updateConfigStatus() {
                    if (this.config.api_key && this.config.api_url) {
                        this.configStatus = `å·²é…ç½®ï¼š${this.config.model || 'é»˜è®¤æ¨¡å‹'}`;
                        this.configStatusOk = true;
                    } else {
                        this.configStatus = 'æœªé…ç½®APIï¼Œä½¿ç”¨æœ¬åœ°ç®—æ³•';
                        this.configStatusOk = false;
                    }
                },

                // ç”Ÿæˆæ–‡æœ¬
                generateTextFromSegments(segments) {
                    if (!segments || segments.length === 0) return '';
                    return segments.map(s => s.text).join('ã€‚') + 'ã€‚';
                },

                // æ¸²æŸ“Markdownä¸ºHTML (ä½¿ç”¨ marked åº“)
                renderMarkdown(markdown) {
                    if (!markdown) return '';
                    try {
                        return marked.parse(markdown);
                    } catch (e) {
                        console.error('Markdownè§£æå¤±è´¥', e);
                        return markdown;
                    }
                },

                // æ ¼å¼åŒ–æ—¶é•¿
                formatDuration(seconds) {
                    if (!seconds || seconds <= 0) return 'æœªçŸ¥';
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${minutes}åˆ†${secs}ç§’`;
                },

                // åˆ‡æ¢æ®µè½å±•å¼€
                toggleSegment(index) {
                    const pos = this.expandedSegments.indexOf(index);
                    if (pos > -1) {
                        this.expandedSegments.splice(pos, 1);
                    } else {
                        this.expandedSegments.push(index);
                    }
                },

                // æ˜¾ç¤ºæ¶ˆæ¯
                showMessage(text, type = 'info') {
                    this.message = { text, type };
                    setTimeout(() => {
                        this.message.text = '';
                    }, 5000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
